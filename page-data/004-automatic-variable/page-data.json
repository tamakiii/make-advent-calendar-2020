{"componentChunkName":"component---src-templates-markdown-js","path":"/004-automatic-variable","result":{"data":{"markdownRemark":{"html":"<h1>自動変数</h1>\n<p>自動変数（<a href=\"https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html\">Automatic Variable</a>）は実行するルールが定まると make が自動的に設定する変数です。</p>\n<p>タスクランナー的な用途で主に使うのは以下の5個です。</p>\n<ul>\n<li><code class=\"language-text\">$@</code> ターゲットのファイル名を表します</li>\n<li><code class=\"language-text\">$^</code> 必要条件（Prerequisite）を表します</li>\n<li><code class=\"language-text\">$&lt;</code> 必要条件の最初の1つを表します</li>\n<li><code class=\"language-text\">$(@F)</code> ターゲットのファイル名を表します</li>\n<li><code class=\"language-text\">$(@D)</code> ターゲットのディレクトリ名を表します</li>\n</ul>\n<h2>$@ $% $&#x3C;</h2>\n<p>以前出てきたC言語のプログラムをビルドする Makefile はこうでした。</p>\n<div class=\"gatsby-highlight\" data-language=\"makefile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-makefile line-numbers\"><code class=\"language-makefile\"><span class=\"token symbol\">main.o</span><span class=\"token punctuation\">:</span> main.c\n\tgcc -o main.o main.c</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>これが自動変数を使うとこう書けます。重複した記述が減らせていい感じです。</p>\n<div class=\"gatsby-highlight\" data-language=\"makefile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-makefile line-numbers\"><code class=\"language-makefile\"><span class=\"token symbol\">main.o</span><span class=\"token punctuation\">:</span> main.c\n\tgcc -o <span class=\"token variable\">$@</span> <span class=\"token variable\">$^</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">make</span> main.o\ngcc -o main.o main.c\n$ ./main.o\nreligion</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">$^</code> はターゲットに与えられたすべての必要条件を取るため、必要条件を加えると困ってしまうことがあります。</p>\n<div class=\"gatsby-highlight\" data-language=\"makefile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-makefile line-numbers\"><code class=\"language-makefile\"><span class=\"token builtin\">.PHONY</span><span class=\"token punctuation\">:</span> hoge\n\n<span class=\"token symbol\">main.2.o</span><span class=\"token punctuation\">:</span> main.c hoge\n\tgcc -o <span class=\"token variable\">$@</span> <span class=\"token variable\">$^</span>\n\n<span class=\"token symbol\">hoge</span><span class=\"token punctuation\">:</span>\n\techo <span class=\"token string\">\"do nothing\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">make</span> main.2.o\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"do nothing\"</span>\n<span class=\"token keyword\">do</span> nothing\ngcc -o main.2.o main.c hoge\nclang: error: no such <span class=\"token function\">file</span> or directory: <span class=\"token string\">'hoge'</span>\nmake: *** <span class=\"token punctuation\">[</span>Makefile:5: main.2.o<span class=\"token punctuation\">]</span> Error <span class=\"token number\">1</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>そういったときは最初の必要条件だけを表す <code class=\"language-text\">$&lt;</code> が使えます。</p>\n<div class=\"gatsby-highlight\" data-language=\"makefile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-makefile line-numbers\"><code class=\"language-makefile\"><span class=\"token symbol\">main.3.o</span><span class=\"token punctuation\">:</span> main.c hoge\n\tgcc -o <span class=\"token variable\">$@</span> <span class=\"token variable\">$&lt;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">make</span> main.3.o\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"do nothing\"</span>\n<span class=\"token keyword\">do</span> nothing\ngcc -o main.3.o main.c</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>$(@F) $(@D)</h2>\n<p><code class=\"language-text\">$(@F)</code> <code class=\"language-text\">$(@D)</code> はターゲットのファイル名とディレクトリ名です。\n例えばディレクトリの下に生成物を作りたい場合、こんな風に書けます。</p>\n<div class=\"gatsby-highlight\" data-language=\"makefile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-makefile line-numbers\"><code class=\"language-makefile\"><span class=\"token symbol\">bin/main.1.o</span><span class=\"token punctuation\">:</span> main.c\n\tmkdir -p <span class=\"token variable\">$(@D)</span>\n\tgcc -o <span class=\"token variable\">$(@D)</span>/<span class=\"token variable\">$(@F)</span> <span class=\"token variable\">$&lt;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">make</span> bin/main.1.o\n<span class=\"token function\">mkdir</span> -p bin\ngcc -o binmain.1.o main.c</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>ですが、依存関係は必要条件に書くとルールが簡素にできるので、個人的に最近はあまり使わずこのように書くことが多いです。\nbin を必要条件に書き、main.c を最初に配置して <code class=\"language-text\">$&lt;</code> で gcc の infile に与えています。</p>\n<div class=\"gatsby-highlight\" data-language=\"makefile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-makefile line-numbers\"><code class=\"language-makefile\"><span class=\"token symbol\">bin/main.2.o</span><span class=\"token punctuation\">:</span> main.c bin\n\tgcc -o <span class=\"token variable\">$@</span> <span class=\"token variable\">$&lt;</span>\n\n<span class=\"token symbol\">bin</span><span class=\"token punctuation\">:</span>\n\tmkdir <span class=\"token variable\">$@</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">make</span> bin/main.2.o\n<span class=\"token function\">mkdir</span> bin\ngcc -o bin/main.2.o main.c</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>","excerpt":"自動変数 自動変数（Automatic Variable）は実行するルールが定まると make が自動的に設定する変数です。 タスクランナー的な用途で主に使うのは以下の5個です。  ターゲットのファイル名を表します  必要条件（Prerequisite）を表します  必要条件の最初の1つを表します  ターゲットのファ…","frontmatter":{"date":"December 04, 2020","slug":"/004-automatic-variable","title":"自動変数"}}},"pageContext":{"slug":"/004-automatic-variable","nodes":[{"node":{"frontmatter":{"slug":"/001-makefile-in-2020","title":"2020年の Makefile"}}},{"node":{"frontmatter":{"slug":"/002-phony-target-and-prerequisites","title":"偽のターゲットと前提条件"}}},{"node":{"frontmatter":{"slug":"/003-variable","title":"変数"}}},{"node":{"frontmatter":{"slug":"/004-automatic-variable","title":"自動変数"}}},{"node":{"frontmatter":{"slug":"/005-c-and-f-option","title":"-C オプションと -f オプション"}}},{"node":{"frontmatter":{"slug":"/006-default-target","title":"デフォルトターゲット"}}},{"node":{"frontmatter":{"slug":"/007-exit-status","title":"終了ステータス"}}},{"node":{"frontmatter":{"slug":"/008-text-functions","title":"文字列の関数"}}},{"node":{"frontmatter":{"slug":"/009-functions-for-filenames","title":"ファイル名の関数"}}},{"node":{"frontmatter":{"slug":"/010-functions-for-lists","title":"リストの関数"}}}]}},"staticQueryHashes":["3649515864","63159454"]}